<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cookie Run: Kingdom - Team Optimizer</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles_v2.css') }}">
</head>
<body>
    <!-- Main Container -->
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <h1>üç™ Cookie Run: Kingdom Team Optimizer</h1>
            <button id="toggleBookmarksBtn" class="btn-secondary" style="padding: 8px 16px;">
                ‚≠ê Bookmarks (<span id="bookmarkCount">0</span>)
            </button>
        </header>

        <!-- Tab Navigation -->
        <nav class="tab-navigation">
            <button class="tab-btn active" data-tab="team-optimizer">
                <span class="tab-icon">‚öôÔ∏è</span>
                <span class="tab-label">Team Optimizer</span>
            </button>
            <button class="tab-btn" data-tab="counter-team">
                <span class="tab-icon">‚öîÔ∏è</span>
                <span class="tab-label">Counter-Team</span>
            </button>
            <button class="tab-btn" data-tab="guild-battle">
                <span class="tab-icon">üè∞</span>
                <span class="tab-label">Guild Battle</span>
            </button>
            <button class="tab-btn" data-tab="cookie-manager">
                <span class="tab-icon">üìã</span>
                <span class="tab-label">Cookie Manager</span>
            </button>
        </nav>

        <!-- Main Content Area -->
        <div class="content-wrapper">

            <!-- ==================== TAB 1: TEAM OPTIMIZER ==================== -->
            <div id="team-optimizer" class="tab-content active">
                <!-- Sidebar -->
                <aside class="sidebar">
                    <h3>Settings</h3>

                    <div class="setting-group">
                        <label for="method">Method</label>
                        <select id="method" class="input-field">
                            <option value="random">Random Sampling</option>
                            <option value="greedy">Greedy (Power-Focused)</option>
                            <option value="genetic" selected>Genetic Algorithm ‚≠ê (Best)</option>
                            <option value="synergy">Synergy-Optimized üåü (New!)</option>
                            <option value="exhaustive">Exhaustive Search</option>
                        </select>
                        <small id="methodDescription" style="display: block; margin-top: 8px; color: rgba(255,255,255,0.7); font-size: 0.85em; line-height: 1.4;">
                            Fast exploration, generates diverse teams quickly. Good for browsing options.
                        </small>
                    </div>

                    <div class="setting-group">
                        <label for="numCandidates">Generations</label>
                        <input type="number" id="numCandidates" class="input-field" value="100" min="10" max="10000">
                    </div>

                    <div class="setting-group">
                        <label for="topN">Teams</label>
                        <input type="number" id="topN" class="input-field" value="5" min="1" max="10">
                    </div>

                    <div class="setting-group">
                        <label for="maxRarity">Max Rarity</label>
                        <select id="maxRarity" class="input-field">
                            <option value="">All Rarities</option>
                            <option value="Common">Common and Below</option>
                            <option value="Rare">Rare and Below</option>
                            <option value="Epic">Epic and Below</option>
                            <option value="Super Epic">Super Epic and Below</option>
                            <option value="Special">Special and Below</option>
                            <option value="Legendary">Legendary and Below</option>
                            <option value="Dragon">Dragon and Below</option>
                            <option value="Ancient">Ancient and Below</option>
                        </select>
                    </div>

                    <div class="setting-group checkbox-group">
                        <label>
                            <input type="checkbox" id="excludeAscended">
                            <span>Exclude Ascended</span>
                        </label>
                    </div>

                    <hr class="divider">

                    <h4>Required Cookies</h4>
                    <div id="selectedCookies" class="selected-cookies-sidebar">
                        <p class="empty-state">None selected</p>
                    </div>

                    <div style="display: flex; gap: 8px; margin-bottom: 10px;">
                        <button id="optimizeBtn" class="btn-primary" style="flex: 1;">
                            üöÄ Optimize
                        </button>
                        <button id="resetOptimizerBtn" class="btn-secondary" style="flex: 0.5;">
                            üîÑ Reset
                        </button>
                    </div>

                    <button id="bookmarkOptimizerBtn" class="btn-secondary" style="width: 100%; display: none;">
                        ‚≠ê Bookmark Teams
                    </button>
                </aside>

                <!-- Main Content -->
                <main class="main-content">
                    <div class="content-header">
                        <h2>Cookie Selection</h2>
                        <input type="text" id="cookieSearch" class="search-bar" placeholder="üîç Search cookies...">
                    </div>

                    <div class="filter-bar">
                        <select id="rarityFilter" class="filter-select">
                            <option value="">All Rarities</option>
                            <option value="Beast">Beast</option>
                            <option value="Ancient">Ancient</option>
                            <option value="Legendary">Legendary</option>
                            <option value="Super Epic">Super Epic</option>
                            <option value="Epic">Epic</option>
                        </select>
                        <select id="roleFilter" class="filter-select">
                            <option value="">All Roles</option>
                            <option value="Charge">Charge</option>
                            <option value="Defense">Defense</option>
                            <option value="Magic">Magic</option>
                            <option value="Healing">Healing</option>
                            <option value="Support">Support</option>
                            <option value="Ranged">Ranged</option>
                            <option value="Bomber">Bomber</option>
                            <option value="Ambush">Ambush</option>
                        </select>
                        <select id="positionFilter" class="filter-select">
                            <option value="">All Positions</option>
                            <option value="Front">Front</option>
                            <option value="Middle">Middle</option>
                            <option value="Rear">Rear</option>
                        </select>
                    </div>

                    <div id="cookieGrid" class="cookie-grid"></div>

                    <!-- Results Section -->
                    <div id="resultsSection" class="results-section" style="display: none;">
                        <h2>Results</h2>
                        <div id="teamsList" class="teams-accordion"></div>
                    </div>
                </main>
            </div>

            <!-- ==================== TAB 2: COUNTER-TEAM ==================== -->
            <div id="counter-team" class="tab-content">
                <!-- Sidebar -->
                <aside class="sidebar">
                    <h3>Settings</h3>

                    <div class="setting-group">
                        <label for="counterMethod">Method</label>
                        <select id="counterMethod" class="input-field">
                            <option value="random" selected>Random</option>
                            <option value="greedy">Greedy</option>
                            <option value="genetic">Genetic</option>
                        </select>
                    </div>

                    <div class="setting-group">
                        <label for="numCounterTeams">Teams</label>
                        <input type="number" id="numCounterTeams" class="input-field" value="5" min="1" max="10">
                    </div>

                    <div class="setting-group">
                        <label for="counterMaxRarity">Max Rarity</label>
                        <select id="counterMaxRarity" class="input-field">
                            <option value="">All Rarities</option>
                            <option value="Common">Common and Below</option>
                            <option value="Rare">Rare and Below</option>
                            <option value="Epic">Epic and Below</option>
                            <option value="Super Epic">Super Epic and Below</option>
                            <option value="Special">Special and Below</option>
                            <option value="Legendary">Legendary and Below</option>
                            <option value="Dragon">Dragon and Below</option>
                            <option value="Ancient">Ancient and Below</option>
                        </select>
                    </div>

                    <hr class="divider">

                    <h4>Enemy Team</h4>
                    <div id="enemySelectedCookies" class="selected-cookies-sidebar">
                        <p class="empty-state">Select 1-5 enemy cookies</p>
                    </div>

                    <div style="display: flex; gap: 8px; margin-bottom: 10px;">
                        <button id="generateCounterBtn" class="btn-primary" style="flex: 1;">
                            ‚öîÔ∏è Generate
                        </button>
                        <button id="resetCounterBtn" class="btn-secondary" style="flex: 0.5;">
                            üîÑ Reset
                        </button>
                    </div>

                    <button id="bookmarkCounterBtn" class="btn-secondary" style="width: 100%; display: none;">
                        ‚≠ê Bookmark Teams
                    </button>
                </aside>

                <!-- Main Content -->
                <main class="main-content">
                    <div class="content-header">
                        <h2>Select Enemy Team (5 Required)</h2>
                        <input type="text" id="enemyCookieSearch" class="search-bar" placeholder="üîç Search cookies...">
                    </div>

                    <div class="filter-bar">
                        <select id="enemyRarityFilter" class="filter-select">
                            <option value="">All Rarities</option>
                            <option value="Beast">Beast</option>
                            <option value="Ancient">Ancient</option>
                            <option value="Legendary">Legendary</option>
                        </select>
                        <select id="enemyRoleFilter" class="filter-select">
                            <option value="">All Roles</option>
                            <option value="Healing">Healing</option>
                            <option value="Defense">Defense</option>
                            <option value="Magic">Magic</option>
                        </select>
                    </div>

                    <div id="enemyCookieGrid" class="cookie-grid"></div>

                    <!-- Counter Results Section -->
                    <div id="counterResultsSection" class="results-section" style="display: none;">
                        <h2>Counter-Teams</h2>
                        <div id="counterTeamsList" class="teams-accordion"></div>
                    </div>
                </main>
            </div>

            <!-- ==================== TAB 3: GUILD BATTLE ==================== -->
            <div id="guild-battle" class="tab-content">
                <!-- Sidebar -->
                <aside class="sidebar">
                    <h3>Guild Battle</h3>

                    <div class="setting-group">
                        <label for="guildBoss">Select Boss</label>
                        <select id="guildBoss" class="input-field">
                            <option value="Red Velvet Dragon">üêâ Red Velvet Dragon</option>
                            <option value="Avatar of Destiny">üëÅÔ∏è Avatar of Destiny</option>
                            <option value="Living Abyss">üåä Living Abyss</option>
                            <option value="Machine-God of the Eternal Void">‚öôÔ∏è Machine-God</option>
                        </select>
                    </div>

                    <div class="setting-group">
                        <label for="guildTeamsCount">Teams to Generate</label>
                        <input type="number" id="guildTeamsCount" class="input-field" value="5" min="1" max="10">
                    </div>

                    <div class="setting-group checkbox-group">
                        <label>
                            <input type="checkbox" id="prioritizeSTier" checked>
                            <span>Include S-Tier Cookies</span>
                        </label>
                        <small style="display: block; margin-top: 5px; color: rgba(255,255,255,0.6); font-size: 0.8em;">
                            When unchecked, S-Tier cookies will be completely excluded from team generation
                        </small>
                    </div>

                    <hr class="divider">

                    <h4>Required Cookies (Optional)</h4>
                    <div id="guildSelectedCookies" class="selected-cookies-sidebar">
                        <p class="empty-state">None selected</p>
                    </div>

                    <div style="display: flex; gap: 8px; margin-bottom: 10px;">
                        <button id="generateGuildBtn" class="btn-primary" style="flex: 1;">
                            üè∞ Generate
                        </button>
                        <button id="resetGuildBtn" class="btn-secondary" style="flex: 0.5;">
                            üîÑ Reset
                        </button>
                    </div>

                    <button id="bookmarkGuildBtn" class="btn-secondary" style="width: 100%; display: none;">
                        ‚≠ê Bookmark Teams
                    </button>

                    <hr class="divider">

                    <div id="bossInfo" class="boss-info-box">
                        <h4>Boss Strategy</h4>
                        <p id="bossDescription">Select a boss to see strategy tips.</p>
                    </div>
                </aside>

                <!-- Main Content -->
                <main class="main-content">
                    <div class="content-header">
                        <h2>Select Cookies for Your Team</h2>
                        <input type="text" id="guildCookieSearch" class="search-bar" placeholder="üîç Search cookies...">
                    </div>

                    <div class="filter-bar">
                        <select id="guildRarityFilter" class="filter-select">
                            <option value="">All Rarities</option>
                            <option value="Beast">Beast</option>
                            <option value="Ancient">Ancient</option>
                            <option value="Legendary">Legendary</option>
                            <option value="Super Epic">Super Epic</option>
                            <option value="Epic">Epic</option>
                        </select>
                        <select id="guildRoleFilter" class="filter-select">
                            <option value="">All Roles</option>
                            <option value="Healing">Healing</option>
                            <option value="Defense">Defense</option>
                            <option value="Magic">Magic</option>
                            <option value="Ranged">Ranged</option>
                            <option value="Ambush">Ambush</option>
                            <option value="Support">Support</option>
                        </select>
                    </div>

                    <div id="guildCookieGrid" class="cookie-grid"></div>

                    <!-- Guild Battle Results Section -->
                    <div id="guildResultsSection" class="results-section" style="display: none;">
                        <h2>Recommended Teams for <span id="selectedBossName"></span></h2>
                        <div id="guildTeamsList" class="teams-accordion"></div>
                    </div>
                </main>
            </div>

            <!-- ==================== TAB 4: COOKIE MANAGER ==================== -->
            <div id="cookie-manager" class="tab-content">
                <!-- Sidebar -->
                <aside class="sidebar">
                    <h3>Cookie Stats</h3>

                    <p class="help-text">Click a cookie to add/edit stats</p>

                    <div id="statsCount" class="stats-summary">
                        <strong>0</strong> cookies with stats
                    </div>

                    <hr class="divider">

                    <button id="clearAllStatsBtn" class="btn-secondary">
                        üóëÔ∏è Clear All Stats
                    </button>
                </aside>

                <!-- Main Content -->
                <main class="main-content">
                    <div class="content-header">
                        <h2>Cookie Collection</h2>
                        <input type="text" id="managerCookieSearch" class="search-bar" placeholder="üîç Search cookies...">
                    </div>

                    <div class="filter-bar">
                        <select id="managerRarityFilter" class="filter-select">
                            <option value="">All Rarities</option>
                            <option value="Beast">Beast</option>
                            <option value="Ancient">Ancient</option>
                            <option value="Legendary">Legendary</option>
                        </select>
                        <select id="managerRoleFilter" class="filter-select">
                            <option value="">All Roles</option>
                        </select>
                        <select id="statsFilterSelect" class="filter-select">
                            <option value="">All Cookies</option>
                            <option value="with-stats">With Stats Only</option>
                            <option value="without-stats">Without Stats Only</option>
                        </select>
                    </div>

                    <div id="managerCookieGrid" class="cookie-grid"></div>
                </main>

                <!-- Stats Editor Side Panel -->
                <div id="statsPanel" class="stats-panel">
                    <div class="stats-panel-header">
                        <h3 id="statsCookieName">Cookie Stats</h3>
                        <button class="close-btn" onclick="closeStatsPanel()">√ó</button>
                    </div>
                    <div class="stats-panel-body">
                        <div id="statsCookieInfo" class="cookie-info-display"></div>

                        <div class="setting-group">
                            <label for="statsCookieLevel">Cookie Level (1-70)</label>
                            <input type="number" id="statsCookieLevel" class="input-field" value="90" min="1" max="90">
                        </div>

                        <div class="setting-group">
                            <label for="statsSkillLevel">Skill Level (1-60)</label>
                            <input type="number" id="statsSkillLevel" class="input-field" value="90" min="1" max="90">
                        </div>

                        <div class="setting-group">
                            <label for="statsStarLevel">Star Level (0-5)</label>
                            <input type="number" id="statsStarLevel" class="input-field" value="5" min="0" max="5">
                        </div>

                        <div class="setting-group">
                            <label>Toppings</label>
                            <div id="statsToppingsContainer" class="toppings-container"></div>
                            <button class="btn-secondary" onclick="addToppingSlot()">+ Add Topping</button>
                        </div>

                        <div class="checkbox-group">
                            <label>
                                <input type="checkbox" id="statsAddToRequired">
                                <span>Add to Required Cookies</span>
                            </label>
                        </div>

                        <div class="panel-actions">
                            <button class="btn-primary" onclick="saveStatsPanel()">Save Stats</button>
                            <button class="btn-secondary" onclick="deleteStatsPanel()">Delete Stats</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading Indicator -->
        <div id="loadingIndicator" class="loading-overlay" style="display: none;">
            <div class="loading-content">
                <div class="spinner"></div>
                <p>Processing...</p>
            </div>
        </div>
    </div>

    <!-- Bookmarks Panel -->
    <div id="bookmarksPanel" class="bookmarks-panel">
        <div class="bookmarks-header">
            <h3>‚≠ê Bookmarked Teams</h3>
            <button class="close-btn" onclick="closeBookmarksPanel()">√ó</button>
        </div>
        <div id="bookmarksList" class="bookmarks-list">
            <p class="empty-state">No bookmarked teams yet. Generate teams and click "‚≠ê Bookmark" to save them here!</p>
        </div>
    </div>

    <script src="{{ url_for('static', filename='app_v2.js') }}?v=4.0"></script>
</body>
</html>
